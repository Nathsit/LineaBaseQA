# Define el trigger, se ejecutar√° en cada push a la rama 'pruebas funcionales'
trigger:
  branches:
    include:
      - pruebas-funcionales

# Usa tu agente personalizado
pool:
  name: 'DANIELP'

stages:
  - stage: BuildAndTest
    displayName: 'Build and Run Robot Tests'
    jobs:
      - job: RobotFrameworkJob
        displayName: 'Robot Framework CI Job'
        steps:

        # Paso 1: Instalar dependencias de Python
        - script: |
            pip install -r requirements.txt
          displayName: 'Install Python Dependencies'

        # Paso 2: Ejecutar los tests directamente con Robot Framework
        - script: |
            robot -d reports test_suites/features/autenticacion/autenticacion_suite.robot test_suites/features/administracion/ test_suites/features/regulaciones/ test_suites/features/social/
          displayName: 'Run Robot Tests'
          workingDirectory: '$(System.DefaultWorkingDirectory)'

        # Paso 3: Publicar los resultados de las pruebas en Azure DevOps
        - task: PublishTestResults@2
          displayName: 'Publish Test Results'
          condition: succeededOrFailed()
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: '**/output.xml'
            searchFolder: '$(System.DefaultWorkingDirectory)/reports'
            failTaskOnFailedTests: true

        # Paso 4: Publicar los reportes HTML como un artefacto
        - task: PublishPipelineArtifact@1
          displayName: 'Publish HTML Reports'
          condition: succeededOrFailed()
          inputs:
            targetPath: 'reports'
            artifactName: 'Robot Test Reports' 